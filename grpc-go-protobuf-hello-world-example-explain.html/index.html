<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Protobuf, Go, gRPC çš„ Hello World ç†è§£ - XguoX - å†™ç‚¹ Ruby ç³Šå£é¥­åƒ</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="XguoX" /><meta name="description" content="ç¤ºä¾‹ä»£ç ä»å®˜æ–¹ç¤ºä¾‹æå–è¿‡æ¥çš„. 1 2 3 4 5 6 // addressbook.proto syntax = &amp;#34;proto3&amp;#34;; package tutorial; import &amp;#34;google/protobuf/timestamp.proto&amp;#34;; // å¯¼å…¥ proto3 æ–°åŠ çš„ timestamp åŒ… å¯¹äºç›®æ ‡è¯­è¨€ä¸º Go, é™¤éæ˜¾å¼çš„æä¾› option go_package åœ¨ .proto æ–‡ä»¶ä¸­, å¦åˆ™, å¦‚æœæŒ‡å®šäº†" /><meta name="keywords" content="Ruby, Golang, Erlang, å‰ç«¯, åç«¯, Android, Elasticsearch, Programmer, Photo, Lens, Camera, Sony, A7r, Fujifilm, Lego" />






<meta name="generator" content="Hugo 0.53 with even 4.0.0" />


<link rel="canonical" href="https://xguox.me/grpc-go-protobuf-hello-world-example-explain.html/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.3eafe5cf.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Protobuf, Go, gRPC çš„ Hello World ç†è§£" />
<meta property="og:description" content="ç¤ºä¾‹ä»£ç ä»å®˜æ–¹ç¤ºä¾‹æå–è¿‡æ¥çš„. 1 2 3 4 5 6 // addressbook.proto syntax = &#34;proto3&#34;; package tutorial; import &#34;google/protobuf/timestamp.proto&#34;; // å¯¼å…¥ proto3 æ–°åŠ çš„ timestamp åŒ… å¯¹äºç›®æ ‡è¯­è¨€ä¸º Go, é™¤éæ˜¾å¼çš„æä¾› option go_package åœ¨ .proto æ–‡ä»¶ä¸­, å¦åˆ™, å¦‚æœæŒ‡å®šäº†" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xguox.me/grpc-go-protobuf-hello-world-example-explain.html/" /><meta property="article:published_time" content="2018-08-10T16:01:23&#43;08:00"/>
<meta property="article:modified_time" content="2018-08-10T16:01:23&#43;08:00"/>

<meta itemprop="name" content="Protobuf, Go, gRPC çš„ Hello World ç†è§£">
<meta itemprop="description" content="ç¤ºä¾‹ä»£ç ä»å®˜æ–¹ç¤ºä¾‹æå–è¿‡æ¥çš„. 1 2 3 4 5 6 // addressbook.proto syntax = &#34;proto3&#34;; package tutorial; import &#34;google/protobuf/timestamp.proto&#34;; // å¯¼å…¥ proto3 æ–°åŠ çš„ timestamp åŒ… å¯¹äºç›®æ ‡è¯­è¨€ä¸º Go, é™¤éæ˜¾å¼çš„æä¾› option go_package åœ¨ .proto æ–‡ä»¶ä¸­, å¦åˆ™, å¦‚æœæŒ‡å®šäº†">


<meta itemprop="datePublished" content="2018-08-10T16:01:23&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-10T16:01:23&#43;08:00" />
<meta itemprop="wordCount" content="1707">



<meta itemprop="keywords" content="Protobuf,Go,RPC," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Protobuf, Go, gRPC çš„ Hello World ç†è§£"/>
<meta name="twitter:description" content="ç¤ºä¾‹ä»£ç ä»å®˜æ–¹ç¤ºä¾‹æå–è¿‡æ¥çš„. 1 2 3 4 5 6 // addressbook.proto syntax = &#34;proto3&#34;; package tutorial; import &#34;google/protobuf/timestamp.proto&#34;; // å¯¼å…¥ proto3 æ–°åŠ çš„ timestamp åŒ… å¯¹äºç›®æ ‡è¯­è¨€ä¸º Go, é™¤éæ˜¾å¼çš„æä¾› option go_package åœ¨ .proto æ–‡ä»¶ä¸­, å¦åˆ™, å¦‚æœæŒ‡å®šäº†"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div class="row">
    <div class="col s12 m4">
      <div class="table cover">
        <div class="cover-card table-cell table-middle">

  <img src="/img/logo.jpeg" alt="" class="avatar">

  <a href="https://xguox.me/" class="author_name">XguoX</a>
  <span class="author_job">å†™ç‚¹ Ruby ç³Šå£é¥­åƒ</span>
  <span class="author_bio mbm"> ğŸ¨ é•¿è‰å­¦ç”»ç”» ... </span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="https://xguox.me/">home</a>
        <span>/</span>
      </li>

      <li class="nav-item">
        <a href="https://xguox.me/post/">Archive</a>

          <span>/</span>

      </li>

      <li class="nav-item">
        <a href="https://xguox.me/categories/">Categories</a>
      </li>

    </ul>
  </nav>

  <div class="social-links">
    <ul>
        <li><a href="mailto:xguox@hotmail.com" class="iconfont icon-email" title="email"></a></li>
        <li><a href="https://twitter.com/XguoX_L" class="iconfont icon-twitter" title="twitter"></a></li>
        <li><a href="https://github.com/xguox" class="iconfont icon-github" title="github"></a></li>
    <li>
      <a href="https://xguox.me/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
    </li>
    </ul>
  </div>

  <section id="js-search" class="p-3 p-lg-5 d-flex flex-column">
    <div class="my-auto" >
      <form action="https://xguox.me/search">
        <input id="search-query" name="s" placeholder="~$ enter to search"/>
      </form>
    </div>
  </section>
</div>
      </div>
    </div>
    <div class="col s12 m8">
      <div class="post-listing">
        
        <div class="container" id="mobile-panel">
          

          <main id="main" class="main">
            <div class="content-wrapper">
              <div id="content" class="content">
                <article class="post inner">
    <a class="home-btn" href= "https://xguox.me/" >
      Home
    </a>
    
    <header class="post-header">
      <h1 class="post-title">Protobuf, Go, gRPC çš„ Hello World ç†è§£</h1>

      <div class="post-meta">
        <span class="post-time"> 10 Aug 2018 </span>
          <span class="more-meta"> 1707 words </span>
          <span class="more-meta"> 4 mins read </span>
        
      </div>
      <div class="post-category">
          <a href="/categories/protobuf/"> Protobuf </a>
          <a href="/categories/go/"> Go </a>
          <a href="/categories/rpc/"> RPC </a>
          </div>
    </header>

    
    <div class="post-content">
      

<p><a href="https://github.com/xguox/protobuf_example">ç¤ºä¾‹ä»£ç </a>ä»<a href="https://github.com/google/protobuf/tree/master/examples">å®˜æ–¹ç¤ºä¾‹</a>æå–è¿‡æ¥çš„.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// addressbook.proto
</span><span class="c1"></span>
<span class="nx">syntax</span> <span class="p">=</span> <span class="s">&#34;proto3&#34;</span><span class="p">;</span>
<span class="kn">package</span> <span class="nx">tutorial</span><span class="p">;</span>

<span class="kn">import</span> <span class="s">&#34;google/protobuf/timestamp.proto&#34;</span><span class="p">;</span> <span class="o">//</span> <span class="nx">å¯¼å…¥</span> <span class="nx">proto3</span> <span class="nx">æ–°åŠ çš„</span> <span class="nx">timestamp</span> <span class="nx">åŒ…</span></code></pre></td></tr></table>
</div>
</div>
<p>å¯¹äºç›®æ ‡è¯­è¨€ä¸º Go, é™¤éæ˜¾å¼çš„æä¾› <code>option go_package</code> åœ¨ <strong>.proto</strong> æ–‡ä»¶ä¸­, å¦åˆ™, å¦‚æœæŒ‡å®šäº† package, åˆ™ç¼–è¯‘åå°±æ˜¯å¯¹åº”çš„ Go æ–‡ä»¶æ‰€å±çš„ package äº†. ä¸è¿‡å®˜æ–¹å»ºè®®, ä¸ç®¡æ˜¯å¦å®šä¹‰äº† <code>option go_package</code>, åˆæˆ–è€…æ˜¯ Go ä¹‹å¤–å…¶ä»–è¯­è¨€ä¹Ÿæœ€å¥½æŒ‡å®šè¿™ä¸ª package, è¿™æ ·å¯ä»¥ç”¨äºé˜²æ­¢ä¸åŒçš„æ¶ˆæ¯ç±»å‹æœ‰å‘½åå†²çª.</p>

<h4 id="the-protocol-buffer-api">The Protocol Buffer API</h4>

<p>protoc ç¼–è¯‘ç”Ÿæˆçš„ <code>addressbook.pb.go</code> æä¾›äº†ä¸‹é¢è¿™äº›æœ‰ç”¨çš„ç±»å‹:</p>

<ul>
<li>An AddressBook structure with a People field.</li>
<li>A Person structure with fields for Name, Id, Email and Phones.</li>
<li>A Person_PhoneNumber structure, with fields for Number and Type.</li>
<li>The type Person_PhoneType and a value defined for each value in the Person.PhoneType enum.</li>
</ul>

<h5 id="writing-a-message">Writing a Message</h5>

<p><strong>Protocol Buffers</strong> çš„å‡ºç°å°±æ˜¯ä¸ºäº†åºåˆ—åŒ–æ•°æ®ä½¿å…¶èƒ½åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨. å¯¹äº Go æ¥è¯´, åºåˆ—åŒ–æ•°æ®ç”¨çš„æ˜¯ <code>proto</code> åº“çš„ <a href="https://godoc.org/github.com/golang/protobuf/proto#Marshal"><code>Marshal</code> å‡½æ•°</a>. å¯¹åº”äº <code>.proto</code> ä¸­çš„ Message, åœ¨ Go çš„å‘ˆç°æ˜¯ä¸€ä¸ªæŒ‡å‘å®ç°äº† <code>proto.Message</code> æ¥å£çš„ç»“æ„ä½“çš„æŒ‡é’ˆ. é€šè¿‡è°ƒç”¨ <code>proto.Marshal</code> å¾—åˆ°ç¼–ç æˆäºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®(<code>wire format</code>). æ¯”å¦‚è¿™é‡Œçš„ <a href="https://github.com/xguox/protobuf_example/blob/master/add_person.go">add_person</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">book</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">AddressBook</span><span class="p">{}</span>
<span class="c1">// ...
</span><span class="c1"></span>
<span class="c1">// Write the new address book back to disk.
</span><span class="c1"></span><span class="nx">out</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">proto</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">book</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="s">&#34;Failed to encode address book:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">WriteFile</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="nx">out</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="s">&#34;Failed to write address book:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h5 id="reading-a-message">Reading a Message</h5>

<p>å½“éœ€è¦è§£ç æ•°æ®çš„æ—¶å€™, åˆ™ç”¨çš„æ˜¯ <code>proto</code> åº“çš„ <a href="https://godoc.org/github.com/golang/protobuf/proto#Unmarshal"><code>Unmarshal</code> å‡½æ•°</a>, æ¯”å¦‚ <a href="https://github.com/xguox/protobuf_example/blob/master/list_people.go">list_people</a> è¿™é‡Œä»ä¸Šé¢çš„å†™å…¥æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶åºåˆ—åŒ–ä¸º Go çš„ç»“æ„ä½“(<code>book pb.AddressBook</code>).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Read the existing address book.
</span><span class="c1"></span><span class="nx">in</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="nx">fname</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="s">&#34;Error reading file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">book</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">AddressBook</span><span class="p">{}</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">proto</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">in</span><span class="p">,</span> <span class="nx">book</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalln</span><span class="p">(</span><span class="s">&#34;Failed to parse address book:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h5 id="extending-a-protocol-buffer">Extending a Protocol Buffer</h5>

<p>å¦‚æœå¸Œæœ›åœ¨æ›´æ–°äº† <code>.proto</code> èƒ½ <strong>å‘åå…¼å®¹</strong>, é‚£ä¹ˆåœ¨æ–°ç‰ˆæœ¬çš„ <code>.proto</code> ä¸­éœ€è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹:</p>

<ul>
<li>æ‰€æœ‰å·²å­˜åœ¨çš„å­—æ®µçš„å”¯ä¸€æ ‡è¯†å·ä¸èƒ½æ”¹å˜</li>
<li>å¯ä»¥åˆ é™¤å­—æ®µ, ä½†æ˜¯è¯·çœ‹ç¬¬ä¸‰æ¡</li>
<li>å¯ä»¥æ·»åŠ å­—æ®µ, ä½†éœ€è¦ä½¿ç”¨å…¨æ–°çš„æ ‡è¯†å·(ä»æœªç”¨è¿‡çš„, <strong>å·²ç»ç”¨è¿‡ä½†å­—æ®µè¢«åˆ é™¤äº†ä¹Ÿä¸å¯ä»¥</strong>)</li>
</ul>

<hr />

<h3 id="hello-world-grpc">Hello World, gRPC</h3>

<h4 id="server">Server</h4>

<p>ç¤ºä¾‹ä»£ç åœ¨å®‰è£… <a href="https://github.com/grpc/grpc-go">gRPC</a> <code>go get -u google.golang.org/grpc</code> çš„æ—¶å€™å°±å·²ç»æœ‰äº†çš„,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">cd</span> <span class="err">$</span><span class="nx">GOPATH</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">google</span><span class="p">.</span><span class="nx">golang</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">grpc</span><span class="o">/</span><span class="nx">examples</span><span class="o">/</span><span class="nx">helloworld</span>

<span class="k">go</span> <span class="nx">run</span> <span class="nx">greeter_server</span><span class="o">/</span><span class="nx">main</span><span class="p">.</span><span class="k">go</span>

<span class="c1">// From a different terminal:
</span><span class="c1"></span>
<span class="k">go</span> <span class="nx">run</span> <span class="nx">greeter_client</span><span class="o">/</span><span class="nx">main</span><span class="p">.</span><span class="k">go</span>

<span class="p">=&gt;</span> <span class="mi">2018</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">09</span> <span class="mi">19</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">19</span> <span class="nx">Greeting</span><span class="p">:</span> <span class="nx">Hello</span> <span class="nx">world</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>hello.proto</strong></p>

<p>å¦‚æœæƒ³è¦å°† Message ç”¨åœ¨ <strong>RPC(è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)</strong>ç³»ç»Ÿä¸­, å¯ä»¥åœ¨ <code>.proto</code> æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª rpc æœåŠ¡æ¥å£, Protocol Buffer ç¼–è¯‘å™¨ä¼šåƒ <code>message</code> ä¸€æ ·ç¼–è¯‘æˆå¯¹åº”è¯­è¨€çš„ä»£ç . æ¯”å¦‚ä¸‹é¢çš„ <code>helloworld.proto</code>, å®šä¹‰ä¸€ä¸ª rpc æ–¹æ³•, æ¥æ”¶ <code>HelloRequest</code> æ¶ˆæ¯å¹¶è¿”å›ä¸€ä¸ª <code>HelloReply</code> æ¶ˆæ¯:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// The greeting service definition.
</span><span class="c1"></span><span class="nx">service</span> <span class="nx">Greeter</span> <span class="p">{</span>
  <span class="c1">// Sends a greeting
</span><span class="c1"></span>    <span class="nx">rpc</span> <span class="nf">SayHello</span> <span class="p">(</span><span class="nx">HelloRequest</span><span class="p">)</span> <span class="nf">returns</span> <span class="p">(</span><span class="nx">HelloReply</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// The request message containing the user&#39;s name.
</span><span class="c1"></span><span class="nx">message</span> <span class="nx">HelloRequest</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="nx">name</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// The response message containing the greetings
</span><span class="c1"></span><span class="nx">message</span> <span class="nx">HelloReply</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="nx">message</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>ç¼–è¯‘æˆ Go ä»¥åæ˜¯è¿™é‡Œçš„ <a href="https://github.com/xguox/grpc_example/blob/master/helloworld/helloworld.pb.go">helloworld.pb.go</a>. ç›¸æ¯”èµ·å‰åŠéƒ¨åˆ†çš„ä¾‹å­, ä¸»è¦åŒºåˆ«æ˜¯è¿™ä¸ª</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">service</span> <span class="nx">Greeter</span> <span class="p">{</span>
    <span class="c1">// Sends a greeting
</span><span class="c1"></span>    <span class="nx">rpc</span> <span class="nf">SayHello</span> <span class="p">(</span><span class="nx">HelloRequest</span><span class="p">)</span> <span class="nf">returns</span> <span class="p">(</span><span class="nx">HelloReply</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>å¯¹åº”çš„, ç”Ÿæˆçš„ Go ä»£ç ä¸»è¦å¤šäº†ä¸¤ä¸ªæ¥å£:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// GreeterClient is the client API for Greeter service.
</span><span class="c1">//
</span><span class="c1">// For semantics around ctx use and closing/ending streaming RPCs, please refer to https://godoc.org/google.golang.org/grpc#ClientConn.NewStream.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">GreeterClient</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="c1">// Sends a greeting
</span><span class="c1"></span>    <span class="nf">SayHello</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">HelloRequest</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">HelloReply</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">greeterClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">cc</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConn</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewGreeterClient</span><span class="p">(</span><span class="nx">cc</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConn</span><span class="p">)</span> <span class="nx">GreeterClient</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">greeterClient</span><span class="p">{</span><span class="nx">cc</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">greeterClient</span><span class="p">)</span> <span class="nf">SayHello</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">HelloRequest</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">HelloReply</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">out</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">HelloReply</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cc</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;/helloworld.Greeter/SayHello&#34;</span><span class="p">,</span> <span class="nx">in</span><span class="p">,</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">out</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// GreeterServer is the server API for Greeter service.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">GreeterServer</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="c1">// Sends a greeting
</span><span class="c1"></span>    <span class="nf">SayHello</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="o">*</span><span class="nx">HelloRequest</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">HelloReply</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>server ç«¯ <code>main.go</code></p>

<p>è¿™é‡Œçš„ pb æ˜¯ helloworld åŒ…çš„åˆ«å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// server is used to implement helloworld.GreeterServer.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">server</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// SayHello implements helloworld.GreeterServer
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">server</span><span class="p">)</span> <span class="nf">SayHello</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">HelloRequest</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">HelloReply</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">HelloReply</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;Hello &#34;</span> <span class="o">+</span> <span class="nx">in</span><span class="p">.</span><span class="nx">Name</span><span class="p">},</span> <span class="kc">nil</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p><code>lis, err := net.Listen(&quot;tcp&quot;, port)</code> ç»‘å®šç«¯å£ï¼Œç„¶åç›‘å¬ï¼Œå½“æœ‰æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œè¯»å–å¹¶å›å¤ç»™å®¢æˆ·ç«¯</p>

<p>Go çš„ <code>net</code> åŒ…æä¾›äº†ç½‘ç»œ I/O(TCP/IP, UDP, domain name resolution, Unix domain sockets) éœ€è¦ç”¨åˆ°çš„æ¥å£</p>

<p><img src="http://wx1.sinaimg.cn/large/62fdd4d5gy1fu3p2zidinj225m0tctha.jpg" alt="" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go">    <span class="nx">s</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">NewServer</span><span class="p">()</span></code></pre></td></tr></table>
</div>
</div>
<p><img src="http://wx3.sinaimg.cn/large/62fdd4d5gy1fu3p9qakuhj214k0angnx.jpg" alt="" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go">    <span class="nx">pb</span><span class="p">.</span><span class="nf">RegisterGreeterServer</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">server</span><span class="p">{})</span>
    <span class="c1">// Register reflection service on gRPC server.
</span><span class="c1"></span>    <span class="nx">reflection</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>helloworld.pb.go</strong> çš„å‡½æ•° <code>RegisterGreeterServer</code>, å®é™…ä¸Šè°ƒçš„æ˜¯ grpc.Server çš„å®ä¾‹æ–¹æ³• <code>RegisterService</code>,</p>

<p><code>_Greeter_serviceDesc</code> çœ‹åå­—å°±æ˜¯å¯¹è¿™ä¸ª <strong>Greeter</strong> rpc æœåŠ¡çš„ä¸€äº›æè¿°äº†,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">_Greeter_serviceDesc</span> <span class="p">=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nx">ServiceDesc</span><span class="p">{</span>
    <span class="nx">ServiceName</span><span class="p">:</span> <span class="s">&#34;helloworld.Greeter&#34;</span><span class="p">,</span>
    <span class="nx">HandlerType</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="nx">GreeterServer</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span>
    <span class="nx">Methods</span><span class="p">:</span> <span class="p">[]</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">MethodDesc</span><span class="p">{</span>
        <span class="p">{</span>
            <span class="nx">MethodName</span><span class="p">:</span> <span class="s">&#34;SayHello&#34;</span><span class="p">,</span>
            <span class="nx">Handler</span><span class="p">:</span>    <span class="nx">_Greeter_SayHello_Handler</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="nx">Streams</span><span class="p">:</span>  <span class="p">[]</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">StreamDesc</span><span class="p">{},</span>
    <span class="nx">Metadata</span><span class="p">:</span> <span class="s">&#34;helloworld.proto&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="o">...</span>

<span class="kd">func</span> <span class="nf">RegisterGreeterServer</span><span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">Server</span><span class="p">,</span> <span class="nx">srv</span> <span class="nx">GreeterServer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s</span><span class="p">.</span><span class="nf">RegisterService</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">_Greeter_serviceDesc</span><span class="p">,</span> <span class="nx">srv</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p><img src="http://wx4.sinaimg.cn/large/62fdd4d5gy1fu3pp8x0tdj21li0l6wjp.jpg" alt="" /></p>

<p><code>ht := reflect.TypeOf(sd.HandlerType).Elem()</code> è¿™é‡Œä¹Ÿå°±æ˜¯ <code>reflect.TypeOf((*pb.GreeterServer)(nil)).Elem()</code> ç»“æœæ˜¯ <code>helloworld.GreeterServer</code></p>

<p><code>st := reflect.TypeOf(ss)</code> å¯¹åº”çš„æ˜¯ <code>reflect.TypeOf(&amp;server{})</code>, è¿”å›ç»“æœæ˜¯ <code>*main.server</code></p>

<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ <strong>main.go</strong> çš„ <code>server</code> ç»“æ„ä½“å®ç°äº† <code>helloworld.GreeterServer</code> è¿™ä¸ªæ¥å£, æ‰€ä»¥, <code>st.Implements(ht)</code> è¿”å› <code>true</code></p>

<p>æ·±å…¥ä¸‹å»å°±ä¸å¤Ÿ hello world äº†, å¾€åçœ‹çœ‹å†æ·±å…¥åˆ†æä¸€ä¸‹, æ€»çš„æ¥è¯´å°±æ˜¯æ³¨å†Œè¿™ä¸ªæœåŠ¡å‘—.</p>

<p>æœ€åè¿™é‡Œ <code>s.Serve(lis)</code>, æœ¬æ¥æƒ³è´´æºç çš„, å·®ä¸å¤šä¸€ç™¾è¡Œç®—äº†, è´´æè¿°å¥½äº†</p>

<blockquote>
<p>Serve accepts incoming connections on the listener lis, creating a new
    ServerTransport and service goroutine for each. The service goroutines
    read gRPC requests and then call the registered handlers to reply to them.
    Serve returns when lis.Accept fails with fatal errors.  lis will be closed when
    this method returns.
    Serve will return a non-nil error unless Stop or GracefulStop is called.</p>
</blockquote>

<h4 id="client">Client</h4>

<p>ä¸»è¦ä»£ç å°±ä¸‹é¢è¿™ä¸‰å¥:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Set up a connection to the server.
</span><span class="c1"></span><span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">())</span>

<span class="nx">c</span> <span class="o">:=</span> <span class="nx">pb</span><span class="p">.</span><span class="nf">NewGreeterClient</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>

<span class="nx">r</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">SayHello</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">pb</span><span class="p">.</span><span class="nx">HelloRequest</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span> <span class="nx">name</span><span class="p">})</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Dial creates a client connection to the given target.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Dial</span><span class="p">(</span><span class="nx">target</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">DialOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">ClientConn</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">DialContext</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// DialContext creates a client connection to the given target. By default, it&#39;s
</span><span class="c1">// a non-blocking dial (the function won&#39;t wait for connections to be
</span><span class="c1">// established, and connecting happens in the background). To make it a blocking
</span><span class="c1">// dial, use WithBlock() dial option.
</span><span class="c1">//
</span><span class="c1">// In the non-blocking case, the ctx does not act against the connection. It
</span><span class="c1">// only controls the setup steps.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">DialContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">target</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">DialOption</span><span class="p">)</span> <span class="p">(</span><span class="nx">conn</span> <span class="o">*</span><span class="nx">ClientConn</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="c1">// ClientConn represents a client connection to an RPC server.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">ClientConn</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>helloworld.pb.go</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">greeterClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">cc</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConn</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewGreeterClient</span><span class="p">(</span><span class="nx">cc</span> <span class="o">*</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">ClientConn</span><span class="p">)</span> <span class="nx">GreeterClient</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">greeterClient</span><span class="p">{</span><span class="nx">cc</span><span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></pre></td>
<td class="lntd">
<pre class="chroma">r, err := c.SayHello(ctx, &amp;pb.HelloRequest{Name: name})
...
log.Printf(&#34;Greeting: %s&#34;, r.Message)</pre></td></tr></table>
</div>
</div>
<p>å¯¹åº”çš„ <code>SayHello</code> æ–¹æ³•å’Œ <code>HelloReply</code> ç»“æ„ä½“</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// The response message containing the greetings
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">HelloReply</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Message</span>              <span class="kt">string</span>   <span class="s">`protobuf:&#34;bytes,1,opt,name=message,proto3&#34; json:&#34;message,omitempty&#34;`</span>
    <span class="nx">XXX_NoUnkeyedLiteral</span> <span class="kd">struct</span><span class="p">{}</span> <span class="s">`json:&#34;-&#34;`</span>
    <span class="nx">XXX_unrecognized</span>     <span class="p">[]</span><span class="kt">byte</span>   <span class="s">`json:&#34;-&#34;`</span>
    <span class="nx">XXX_sizecache</span>        <span class="kt">int32</span>    <span class="s">`json:&#34;-&#34;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">greeterClient</span><span class="p">)</span> <span class="nf">SayHello</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">in</span> <span class="o">*</span><span class="nx">HelloRequest</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">CallOption</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">HelloReply</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">out</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">HelloReply</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cc</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;/helloworld.Greeter/SayHello&#34;</span><span class="p">,</span> <span class="nx">in</span><span class="p">,</span> <span class="nx">out</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">out</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/protobuf/">Protobuf</a>
          <a href="/tags/go/">Go</a>
          <a href="/tags/rpc/">RPC</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/golang-new-make-diff.html/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">new ä¸ make çš„åŒºåˆ« [Go]</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/protocol-buffers-learning.html/">
            <span class="next-text nav-default">å­¦ç‚¹ Protocol Buffers</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
              </div>
              <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'xguox';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

            </div>
          </main>

          <footer id="footer" class="footer">
            <div class="social-links">
      <a href="mailto:xguox@hotmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/XguoX_L" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/xguox" class="iconfont icon-github" title="github"></a>
  <a href="https://xguox.me/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme -
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy;
    2011 -
    2019
    <span class="heart">
      <i class="iconfont icon-bulb"></i>
    </span>
    <span class="author">XguoX</span>
  </span>
</div>
          </footer>

          <div class="back-to-top" id="back-to-top">
            <i class="iconfont icon-up"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.733a52a9.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62252083-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
